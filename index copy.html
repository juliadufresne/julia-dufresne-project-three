<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>2D Collision Game</title>
</head>
<style>
/* CSS Starts */
:root {
    --x: 0px;
    /* --y: 100px; */
}

section {
    background-color: #f2f2f2;
    width: 500px;
    height: 600px;
    position: relative;
    overflow: hidden;
    /* z-index: -1; */
}

.character {
    width: 50px;
    height: 50px;
    background-color: pink;
    position: absolute;
    bottom: 30px;
    right: calc((500px / 2) - 25px);
    border-radius: 25px;
    transform: translateX(var(--x));
}

.collider {
    width: 50px;
    height: 50px;
    background-color: cadetblue;
    position: absolute;
    bottom: 30px;
    right: calc((500px / 3) - 25px);
    border-radius: 25px;
}
</style>
<body>
<!-- HTML Starts -->

<h1>2D Game</h1>
<section class="gameArea">
    <div class="character"></div>
    <div class="collider"></div>
</section>
<!-- https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame -->
<!-- $('.slider').css('transform',"translateX("+whatever+"px)"); -->

<!-- Structure application with:

app.object

app.init (Calls all functions and stuff)

init is in document ready

-->

<!-- JavaScript Starts -->

    <script src='https://code.jquery.com/jquery-3.4.0.min.js' integrity='sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=' crossorigin='anonymous'></script>
    <script>
// JavaScript Here

// Pink box
const $character = $(".character");


// Blue box
const $collider = $(".collider");


// Checks x and y position of character
let position = $character.position();

// 
let characterX = 0;


// Senses keystrokes and moves character accordingly
$(document).on('keydown', function(e) {
    
    // If the left key is clicked
    if (e.which === 37) { 

        // The return value is stored in "safe" AKA if the character is hitting the wall it's false, if the character is not hitting the wall its true
        let safe = checkLeft();

        // It is not hitting the wall AND check if the character is intersecting with the collider
        if(safe === true && checkCollision() === false) {

            // Continue to move left or a collider
            characterX = characterX - 4;

            // Move to an update function (character and collider) (loop through colliders within this function)
            $character.css("--x", characterX + "px")

        // If it is hitting the wall
        } else {

            // Do nothing
        }

    // If the right key is clicked
    } else if (e.which === 39) {

        // The return value is stored in "safe" AKA if the character is hitting the wall it's false, if the character is not hitting the wall its true
        let safe = checkRight();

        // It is not hitting the wall AND check if the character is intersecting with the collider
        if(safe === true && checkCollision() === false) {

            // Continue to move right
            characterX = characterX - -4;
            $character.css("--x", characterX + "px")
            
        // If it is hitting the wall or a collider
        } else {

            // Do nothing
        }
    }
})


// // Checks position for character on page to stop when it collides with the wall
// // Returns true - When its not hitting a wall
// // Returns false - When character hits wall
// function checkPosition() {

//     // Updates position after every key stroke (instead of just at the top)
//     position = $character.position()

//     // Checks if hits left wall
//     if (position.left <= 5) {

//         // These returns can return any data type. They are placeholders to reference the result of this function, so I can use that somewhere else
//         return false;

//     // Checks if hits right wall
//     } else if (position.left >= 440) {

//         // These returns can return any data type. They are placeholders to reference the result of this function, so I can use that somewhere else
//         return false;

//     
//     } else {

//         // These returns can return any data type. They are placeholders to reference the result of this function, so I can use that somewhere else
//         return true;
//     }
// }


// Checks if it is safe to continue moving left without intersecting with a wall
function checkLeft() {

    // On every keydown that goes left, the first thing that happens is updating the characters position
    position = $character.position();

    // If the updated position is less than or equal to where the left wall starts
    if (position.left <= 5) {

        // State that check left is false AKA cannot move anymore
        return false;

    // Otherwise, keep moving
    } else {
        return true;
    }
}

// Checks if it is safe to continue moving right without intersecting with a wall
function checkRight() {

        // On every keydown that goes left, the first thing that happens is updating the characters position
    position = $character.position();

        // If the updated position is less than or equal to where the right wall starts
    if (position.left >= 440) {

        // State that check left is false AKA cannot move anymore
        return false;

    // Otherwise, keep moving
    } else {
        return true;
    }
}


// Collision function
function checkCollision() {
    var x1 = $character.offset().left;
    var y1 = $character.offset().top;
    var h1 = $character.outerHeight(true);
    var w1 = $character.outerWidth(true);
    var b1 = y1 + h1;
    var r1 = x1 + w1;
    var x2 = $collider.offset().left;
    var y2 = $collider.offset().top;
    var h2 = $collider.outerHeight(true);
    var w2 = $collider.outerWidth(true);
    var b2 = y2 + h2;
    var r2 = x2 + w2;

    if (b1 < y2 || y1 > b2 || r1 < x2 || x1 > r2) {
        console.log("YOURE ALL CLEAR")

        return false;
    } else {
        console.log("COLLISION DETECTED");

        return true;
    }
}



    </script>
</body>
</html>