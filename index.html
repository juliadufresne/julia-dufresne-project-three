<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>2D Collision Game</title>
</head>
<style>
/* CSS Starts */
:root {
    --x: 0px;
}

section {
    background-color: #f2f2f2;
    width: 500px;
    height: 600px;
    position: relative;
    overflow: hidden;
    /* z-index: -1; */
}

.character {
    width: 50px;
    height: 50px;
    background-color: pink;
    position: absolute;
    bottom: 30px;
    right: calc((500px / 2) - 25px);
    /* border-radius: 25px; */
    transform: translateX(var(--x));
    transition: transform .2s ease;
}

.collider {
    width: 50px;
    height: 50px;
    background-color: cadetblue;
    position: absolute;
    top: -50px;
    right: 20px;
    /* border-radius: 25px; */
}

.collider2 {
    width: 50px;
    height: 50px;
    background-color: yellowgreen;
    position: absolute;
    top: 50px;
    right: 100px;
    /* border-radius: 25px; */
}

.collider3 {
    width: 50px;
    height: 50px;
    background-color: crimson;
    position: absolute;
    top: 50px;
    right: 300px;
    /* border-radius: 25px; */
}

</style>
<body>
<!-- HTML Starts -->

<h1>2D Game</h1>
<section class="gameArea">
    <div class="character"></div>
    <div class="collider"></div>
    <div class="collider2"></div>
    <div class="collider3"></div>
</section>

<!-- JavaScript Starts -->

<script src='https://code.jquery.com/jquery-3.4.0.min.js' integrity='sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=' crossorigin='anonymous'></script>
<script>

// JavaScript Here

const game = {};

// Character (pink box)
game.character = $(".character");


// Collider (blue box)
game.collider = $(".collider");

game.collider2 = $(".collider2");

game.collider3 = $(".collider3");


// Checks x and y position of character
game.position = game.character.position();

// Checks x and y position of collider
game.colliderPosition = game.collider.position();


game.colliderPosition2 = game.collider2.position();

// Updates character to move
game.characterX = 0;


game.collider.animate({
    top: "+=650"
},8000, function() {
    // Animation complete.
}),

game.collider2.animate({
    top: "+=650"
},8000, function() {
    // Animation complete.
}),

game.collider3.animate({
    top: "+=650"
},8000, function() {
    // Animation complete.
}),



// Checks if its safe to move character (that it's not intersecting with wall or collider)
game.moveChecker = function(e) {

        // If the left key is clicked
        if (e.which === 37) { 

        // The return value is stored in "safe" AKA if the character is hitting the wall it's false, if the character is not hitting the wall its true
        let safe = game.checkLeft();

        // It is not hitting the wall AND check if the character is intersecting with the collider
        if(safe === true && game.checkCollision(game.collider) === false && game.checkCollision(game.collider2) === false && game.checkCollision(game.collider3) === false) {

            // Continue to move right
            game.characterX = game.characterX - 10;
            game.character.css("--x", game.characterX + "px");
            // animate();

        // If it is hitting the wall
        } else {
            
            // Do nothing
        }

        // If the right key is clicked
        } else if (e.which === 39) {

        // The return value is stored in "safe" AKA if the character is hitting the wall it's false, if the character is not hitting the wall its true
        let safe = game.checkRight();

        // It is not hitting the wall AND check if the character is intersecting with the collider
        if(safe === true && game.checkCollision(game.collider) === false && game.checkCollision(game.collider2) === false && game.checkCollision(game.collider3) === false) {

            // Continue to move right
            game.characterX = game.characterX - -10;
            game.character.css("--x", game.characterX + "px")
            
        // If it is hitting the wall or a collider
        } else {
            
            // Do nothing
        }
    }
}

// Checks if it is safe to continue moving left without intersecting with a wall
game.checkLeft = function() {

    // On every keydown that goes left, the first thing that happens is updating the characters position
    game.position = game.character.position();

    // If the updated position is less than or equal to where the left wall starts
    if (game.position.left <= 20) {

        // State that check left is false AKA cannot move anymore
        return false;

    // Otherwise, keep moving
    } else {
        return true;
    }
}

// Checks if it is safe to continue moving right without intersecting with a wall
game.checkRight = function() {

    // On every keydown that goes left, the first thing that happens is updating the characters position
    game.position = game.character.position();

        // If the updated position is less than or equal to where the right wall starts
    if (game.position.left >= 435) {

        // State that check left is false AKA cannot move anymore
        return false;

    // Otherwise, keep moving
    } else {
        return true;
    }
}


// Collision function
game.checkCollision = function(enemy) {
    var x1 = game.character.offset().left;
    var y1 = game.character.offset().top;
    var h1 = game.character.outerHeight(true);
    var w1 = game.character.outerWidth(true);
    var b1 = y1 + h1;
    var r1 = x1 + w1;
    var x2 = $(enemy).offset().left;
    var y2 = $(enemy).offset().top;
    var h2 = $(enemy).outerHeight(true);
    var w2 = $(enemy).outerWidth(true);
    var b2 = y2 + h2;
    var r2 = x2 + w2;

    if (b1 < y2 || y1 > b2 || r1 < x2 || x1 > r2) {
        console.log("YOURE ALL CLEARüçë")

        return false;
    } else {
        console.log("COLLISION DETECTEDü§ñ");
        
        return true;
    }
}



game.init = function() {
    // Senses keystrokes and moves character accordingly
    $(document).on('keydown', game.moveChecker);
    // $(document).on('window', game.moveChecker);

    let checker = setInterval(function() {

        // game.checkCollision(game.collider);
        // game.checkCollision(game.collider2);
        // game.checkCollision(game.collider3);

        if (game.checkCollision(game.collider) === true || game.checkCollision(game.collider2) === true || game.checkCollision(game.collider3) === true) {
            game.collider.animate().stop();
            game.collider2.animate().stop();
            game.collider3.animate().stop();
            stopChecker();
        }
    }, 200);

    function stopChecker() {
        clearInterval(checker)
    }

    setTimeout(function() {
        stopChecker();
    }, 8000)
}


$(function() {
    game.init();
});


</script>
</body>
</html>